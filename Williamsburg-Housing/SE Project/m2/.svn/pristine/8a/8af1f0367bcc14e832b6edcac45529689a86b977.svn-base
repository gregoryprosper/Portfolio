<?php
        include 'misc.php';
        require 'login.php';
        session_start();
        $id = $_POST['id'];

        //try connect to db
        $mysqli = new mysqli($db_hostname, $db_username, $db_password,$db_database);
        
        if (mysqli_connect_errno()) {
            printf("Connect failed: %s\n", mysqli_connect_error());
            exit();
        }
        
        if (isset($_POST["street"]) && !empty($_POST["street"])) {
            $street =  addslashes($_POST["street"]);
            $sql = "UPDATE Listings SET Street = '$street' WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (isset($_POST["city"]) && !empty($_POST["city"])) {
            $city = addslashes($_POST["city"]);
            $sql = "UPDATE Listings SET City = '$city' WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (isset($_POST["zipCode"]) && !empty($_POST["zipCode"])) {
            $zipCode =  $_POST["zipCode"];
            $sql = "UPDATE Listings SET zipCode = '$zipCode' WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (isset($_POST["beds"]) && !empty($_POST["beds"])) {
            $beds =  $_POST["beds"];
            $sql = "UPDATE Listings SET Beds = $beds WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (isset($_POST["baths"]) && !empty($_POST["baths"])) {
            $baths =  $_POST["baths"];
            $sql = "UPDATE Listings SET Baths = $baths WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (isset($_POST["size"]) && !empty($_POST["size"])) {
            $size =  $_POST["size"];
            $sql = "UPDATE Listings SET Size = $size WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (isset($_POST["price"]) && !empty($_POST["price"])) {
            $price =  $_POST["price"];
            $sql = "UPDATE Listings SET Price = $price WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (isset($_POST["forRent"])) {
            $sql = "UPDATE Listings SET For_Rent_Bool = 1 WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (!isset($_POST["forRent"])) {
            $sql = "UPDATE Listings SET For_Rent_Bool = 0 WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (isset($_POST["petsAllowed"])) {
            $sql = "UPDATE Listings SET Pets_Allowed_Bool = 1 WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (!isset($_POST["petsAllowed"])) {
            $sql = "UPDATE Listings SET Pets_Allowed_Bool = 0 WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (isset($_POST["description"])) {
            $description = addslashes($_POST['description']);
            $sql = "UPDATE Listings SET Description = '$description' WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (isset($_POST["typeOfHome"])) {
            $typeOfHome = $_POST['typeOfHome'];
            $sql = "UPDATE Listings SET Type_of_Home = '$typeOfHome' WHERE id = $id";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }
        
        if (is_uploaded_file($_FILES['uploadFile']['tmp_name'])) {
            
            $q = "SELECT cover FROM Listings WHERE id = $id";
            $result = $mysqli->query($q);
            $obj = $result->fetch_object();
            $oldDir = $obj->cover;
            unlink($oldDir);
            
            if (move_uploaded_file($_FILES["uploadFile"]["tmp_name"], $oldDir)) {
                echo "The file ". basename( $_FILES["uploadFile"]["name"]). " has been uploaded.";
            }
            
            $sql = "UPDATE Listings SET cover = '$oldDir' WHERE id = '$id'";
            $mysqli->query($sql);
            $_SESSION['listingUpdated'] = 1;
        }

        header("location:../editMyListing.php?id=$id")
?>

